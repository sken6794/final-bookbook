<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="site.itwill.mapper.DocumentMapper">
	<!-- 전자결재 입력-->
	<insert id="insertDocument">
		<selectKey resultType="int" keyProperty="docNo" order="BEFORE">
		select seq_document.nextval from dual
		</selectKey>
		insert into document values(
			#{docno}, #{docname}, #{doccont}, #{docstate}, #{docaprv}, sysdate, null, 
			null ,#{mno}, #{pno})
	</insert> 
	<!-- 승인자 선택 : 직급이 제일 높고 근무 중 
	<resultMap type="Member" id="member">
		<result column="mno" property="mno"/>
		<result column="mname" property="mname"/>
		<result column="pno" property="pno"/>
		<result column="mstate" property="mstate"/>
	</resultMap>
	<resultMap type="Document" id="documentAprv">
		<result column="docaprv" property="docaprv"/>
		<collection property="member" resultMap="member"/>
	</resultMap>
	<select id="selectAprv" resultMap="documentAprv">
		select document.docaprv from document from member 
			where member.pno=(select max(member.pno) from member) and member.mstate=1;
	</select>
	-->
	<!-- 전자결재 선택 -->
	<select id="selectDocumentList" resultType="Document">
		select * from document order by docno desc
	</select>
	
	<!-- 전자결재 수정
	<update id="updateDocument">
		UPDATE DOCUMENT SET DOCNAME=#{DOCNAME}, DOCCON= #{DOCCON}, DOCSTATE=#{DOCSTATE},
			DOCAPRV=#{DOCAPRV}, DOCCOMP=SYSDATE, REJECT=#{REJECT} WHERE DOCNO = #{DOCNO};
	</update>
	 -->
	<!-- 전자결재 상태 
	<update id="updateState">
		UPDATE DOCUMENT SET DOCSTATE=#{DOCSTATE} WHERE DOCNO = #{DOCNO};
	</update>
	-->
	<!-- 전자결재 반려 
	<update id="updateReject">
		UPDATE DOCUMENT SET DOCSTATE=5, REJECT=#{REJECT} WHERE DOCNO = #{DOCNO};
	</update>
	-->
	<!-- 전자결재 승인 
	<update id="updateAprv">
		UPDATE DOCUMENT SET DOCSTATE=4, DOCAPRV=#{DOCAPRV}, DOCCOMP=SYSDATE WHERE DOCNO = #{DOCNO}
	</update>
	-->
	<!-- 전자결재 삭제 
	<update id="updateAprv">
		UPDATE DOCUMENT SET DOCSTATE=0 WHERE DOCNO = ${DOCNO}
	</update>
	-->
</mapper>